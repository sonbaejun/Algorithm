<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body class="dark" style="background: rgb(211, 209, 209);">
    <header style="height: 70px; background: black; margin-bottom: 15px;">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#" style="color: white;">집꾸미기</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#" style="color: white;">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" style="color: white;">스토어</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" style="color: white;">시공견적</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div style="margin-left: 148px; margin-bottom: 30px;">
        <input onkeyup="filter()" type="text" id="searchInput" class="form-control" placeholder="검색어 입력"
            style="width: 200px;">
    </div>

    <div class="container">
        <div class="row">
        </div>
    </div>

    <div class="container" style="background: rgb(124, 120, 120);">
        <h4>장바구니</h4>
        <div class="container" style="background: black; height: 300px;">
            <h4 style="color: white; text-align: center; line-height : 300px">여기로 드래그</h4>
        </div>
        <h3>최종가격:</h3>
        <button>구매하기</button>

    </div>

    <script type="text/javascript">
        let jsonArr = [];
        
        /* JSON파일 ajax로 load */
        $.ajax({
            type: "get",
            url: "store.json",
            dataType: "json",
            success: function (data) {
                jsonArr = data.products;
                appendCard(data.products);
            },
            error: function () {
                console.log("통신에러");
            }
        })

        /* 상품 Card 생성 */
        function appendCard(data) {
            data.forEach((a) => {
                $('.row').append(
                    `<div class="col-sm-2" style="background: white; margin: 15px;" draggable="true">
                        <img src="${a.photo}" class="w-100">
                        <h5 class="title">${a.title}</h5>
                        <h3>${a.brand}</h3>
                        <p>가격 : ${a.price}</p>
                        <button class="buy">담기</button>
                    </div>`);
            });
        };

        /* 검색 함수 */
        function filter() {
            $('.row').html('');
            let newArr = [];
            let value = $('#searchInput').val();
            for (let i = 0; i < jsonArr.length; i++) {
                console.log(value);
                if (jsonArr[i].title.includes(value) || jsonArr[i].brand.includes(value)) {
                    newArr.push(jsonArr[i]);
                }
            }
            appendCard(newArr);
            newArr = [];
        }

        $('.buy').on('click', function () {
            let title = $(this).siblings("h5").html();
            if (localStorage.getItem('cart') == null) {
                localStorage.setItem('cart', JSON.stringify([title]));
            } else {
                let getCart = JSON.parse(localStorage.cart);
                if (getCart.includes(title) != true) {
                    getCart.push(title);
                }
                getCart = JSON.stringify(getCart);
                localStorage.setItem('cart', getCart);
            }
            let cart = JSON.parse(localStorage.cart);
            console.log(cart.length);
            console.log(title);
        });


    </script>
    <!-- <script src="detail.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
</body>

</html>